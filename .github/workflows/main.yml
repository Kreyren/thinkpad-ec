---
# CI config for https://github.com

name: CI

on:
    push:
        branches:
            - master
    schedule:
        - cron: '0 0 1 * *'

jobs:
    check:
        name: make test
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2

            - name: Prepare environment
              run: |
                touch .config
                sudo make build-deps

            - name: Test with both patches enabled
              run: |
                make patch_enable_battery
                make test

            - name: Test with batteryonly targets
              run: |
                make patch_disable_keyboard
                make test.batteryonly

            - name: Test with default build
              run: |
                rm -f .config
                make test

            - name: Test we can download all known Lenovo files
              run: |
                make test.img.orig

            - name: Make a test report
                make test.report
